<script lang="ts">
  import { invoke } from "@tauri-apps/api/tauri";
  import { onMount } from "svelte";

  let user: User;

  interface User {
    id: string;
    username: string;
    avatar: string;
  }

  async function getUser() {
    return new Promise<User | null>((r) => {
      invoke<User>("get_user")
        .catch(() => r(null))
        .then((res) => {
          if (res) r(res);
          else r(null);
        });
    });
  }

  onMount(async () => {
    user = await getUser();
  });

  setInterval(async () => {
    user = await getUser();
  }, 500);
</script>

<div
  class="w-full min-h-full bg-[#111218] flex flex-col pl-6 justify-around items-center"
>
  <div class="flex absolute top-0 left-0 translate-x-3 items-center space-x-3">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="2em"
      height="3em"
      viewBox="0 0 243 156"
      fill="none"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M226.404 0H15.7303C11.5588 0.00136694 7.55852 1.65029 4.60881 4.58431C1.65911 7.51834 0.00137424 11.4973 0 15.6467V140.098C0.00137424 144.247 1.65911 148.226 4.60881 151.16C7.55852 154.094 11.5588 155.743 15.7303 155.745H226.404C230.576 155.743 234.576 154.094 237.526 151.16C240.475 148.226 242.133 144.247 242.134 140.098V15.6467C242.133 11.4973 240.475 7.51834 237.526 4.58431C234.576 1.65029 230.576 0.00136694 226.404 0ZM130.488 48.6831C131.16 48.0102 131.96 47.4764 132.841 47.1126C133.722 46.7488 134.667 46.5622 135.621 46.5636H182.433C184.358 46.5636 186.204 47.3242 187.566 48.6782C188.927 50.0322 189.691 51.8687 189.691 53.7835C189.691 55.6984 188.927 57.5348 187.566 58.8888C186.204 60.2428 184.358 61.0035 182.433 61.0035H135.584C134.148 61.0046 132.743 60.5816 131.548 59.788C130.353 58.9944 129.422 57.866 128.872 56.5456C128.323 55.2252 128.179 53.7722 128.46 52.3707C128.741 50.9692 129.434 49.6823 130.451 48.6728L130.488 48.6831ZM97.4925 81.2297L36.1112 116.463C35.519 116.804 34.847 116.983 34.1629 116.983C33.4787 116.984 32.8066 116.805 32.2142 116.464C31.6218 116.124 31.13 115.634 30.7884 115.045C30.4467 114.455 30.2673 113.786 30.2681 113.106V42.639C30.2673 41.9585 30.4467 41.2898 30.7884 40.7002C31.13 40.1106 31.6218 39.621 32.2142 39.2806C32.8066 38.9403 33.4787 38.7612 34.1629 38.7613C34.847 38.7615 35.519 38.941 36.1112 39.2817L97.4666 74.5151C98.0587 74.8557 98.5503 75.3451 98.8921 75.9344C99.2339 76.5237 99.4138 77.1921 99.4138 77.8724C99.4138 78.5527 99.2339 79.221 98.8921 79.8103C98.5503 80.3996 98.0587 80.8891 97.4666 81.2297H97.4925ZM217.404 107.062C216.731 107.735 215.931 108.268 215.05 108.632C214.169 108.996 213.225 109.183 212.271 109.181H135.584C133.659 109.181 131.813 108.421 130.452 107.067C129.09 105.713 128.326 103.876 128.326 101.961C128.326 100.046 129.09 98.21 130.452 96.856C131.813 95.502 133.659 94.7413 135.584 94.7413H212.271C213.707 94.7402 215.112 95.1632 216.307 95.9568C217.502 96.7504 218.433 97.8788 218.983 99.1992C219.533 100.52 219.676 101.973 219.395 103.374C219.114 104.776 218.421 106.062 217.404 107.072V107.062ZM217.404 82.9779C216.731 83.6509 215.931 84.1847 215.05 84.5485C214.169 84.9123 213.225 85.0989 212.271 85.0975H135.584C133.659 85.0975 131.813 84.3368 130.452 82.9828C129.09 81.6288 128.326 79.7924 128.326 77.8775C128.326 75.9627 129.09 74.1263 130.452 72.7723C131.813 71.4183 133.659 70.6576 135.584 70.6576H212.271C213.707 70.6565 215.112 71.0795 216.307 71.8731C217.502 72.6666 218.433 73.7951 218.983 75.1155C219.533 76.4359 219.676 77.8888 219.395 79.2903C219.114 80.6918 218.421 81.9788 217.404 82.9882V82.9779Z"
        fill="white"
      />
    </svg>
    <div class="text-white text-lg">PreMiD</div>
  </div>
  {#if user}
    <div class="flex flex-col items-center select-none">
      <div class="text-white text-xl">Connected</div>
      <div class="text-white text-md">
        Using <span class="font-bold">{user.username}</span> as your account
      </div>
    </div>
  {:else}
    <div class="flex flex-col items-center select-none">
      <div class="text-white text-xl">Text Here</div>
      <div class="text-white text-md">Text There</div>
    </div>
  {/if}
</div>
